@model SmartFoundation.UI.ViewModels.SmartPage.SmartPageViewModel

@{
    // هل يوجد أي محتوى يستحق عرض البانل؟
    var hasPanelContent =
        Model.Form is not null
        || Model.DatePicker is not null
        || Model.TableDS is not null
        || Model.TableDS1 is not null
        || Model.TableDS2 is not null
        || Model.TableDS3 is not null
        || Model.TableDS4 is not null
        || Model.TableDS5 is not null
        || Model.Table is not null;
}

<!-- الشارتات: خارج البانل دائماً -->

@if (Model.Charts is not null)
{
    <div class="w-full">
        <div class="bg-white rounded-sm border border-gray-100 shadow-sm p-6">
            @await Component.InvokeAsync("SmartCharts", new { model = Model.Charts, embedded = true })
        </div>
    </div>
}


<!-- البانل: لا يظهر إلا إذا فيه Form/Table/DatePicker -->
@if (hasPanelContent)
{
    <div x-data="{ open:true }" class="sf-panel mt-6">
        @* <div class="sf-panel-header flex items-center justify-between border-b border-gray-300"> *@
        <div class="sf-panel-header">

            <h3 class="sf-panel-title flex items-center gap-2">
                <i class="fa-solid @(Model.PanelIcon ?? "fa-layer-group") text-emerald-600 text-sm"></i>
                @(Model.PanelTitle ?? Model.PageTitle)
            </h3>

            @* <div class="flex items-center gap-2 text-gray-500"> *@
            <div class="sf-panel-actions">

                @* <button type="button" x-on:click="open = !open" class="hover:text-gray-700 transition"> *@
                <button type="button" x-on:click="open = !open" class="sf-panel-btn" title="تصغير/توسيع">


                    @* <i class="fa-solid" x-bind:class="open ? 'fa-minus' : 'fa-plus'"></i> *@
                    <i class="fa-solid" x-bind:class="open ? 'fa-chevron-up' : 'fa-chevron-down'"></i>

                </button>

                <button type="button"
                        x-on:click="$el.closest('.sf-panel').classList.toggle('sf-panel-full')"
                        
                        class="sf-panel-btn"
                        title="ملء الشاشة">
                    
                    <i class="fa-solid fa-up-right-and-down-left-from-center"></i>

                </button>

                <button type="button"
                        x-on:click="$el.closest('.sf-panel').remove()"
                        @* class="hover:text-red-600 transition" *@
                        class="sf-panel-btn sf-panel-btn-close"
                        title="إغلاق">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>

        <div class="sf-panel-body" x-show="open">
            @if (Model.Form is not null)
            {
                @await Component.InvokeAsync("SmartForm", new { model = Model.Form, embedded = true })
            }

            @if (Model.DatePicker is not null)
            {
                @await Component.InvokeAsync("SmartDatePicker", new { model = Model.DatePicker, embedded = true })
            }

            @if (Model.TableDS is not null)
            {
                @await Component.InvokeAsync("SmartTableDS", new { model = Model.TableDS, embedded = true })
            }
            @if (Model.TableDS1 is not null)
            {
                @await Component.InvokeAsync("SmartTableDS", new { model = Model.TableDS1, embedded = true })
            }
            @if (Model.TableDS2 is not null)
            {
                @await Component.InvokeAsync("SmartTableDS", new { model = Model.TableDS2, embedded = true })
            }
            @if (Model.TableDS3 is not null)
            {
                @await Component.InvokeAsync("SmartTableDS", new { model = Model.TableDS3, embedded = true })
            }
            @if (Model.TableDS4 is not null)
            {
                @await Component.InvokeAsync("SmartTableDS", new { model = Model.TableDS4, embedded = true })
            }
            @if (Model.TableDS5 is not null)
            {
                @await Component.InvokeAsync("SmartTableDS", new { model = Model.TableDS5, embedded = true })
            }
            else if (Model.Table is not null)
            {
                @await Component.InvokeAsync("SmartTable", new { model = Model.Table, embedded = true })
            }
        </div>
    </div>
}
