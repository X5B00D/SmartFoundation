@model SmartFoundation.UI.ViewModels.SmartCharts.ChartCardConfig
@using SmartFoundation.UI.ViewModels.SmartCharts
@using System.Text.Json
@using System.Text.Encodings.Web

@{
    var hostId = $"donut_{Model.Id}";
    var configId = $"{hostId}_cfg";

    // ÃÂ¯“ config ··‹ JS
    var cfg = new
    {
        id = hostId,
        dir = (Model.Dir ?? "rtl").ToLower(),
        mode = string.IsNullOrWhiteSpace(Model.DonutMode) ? "donut" : Model.DonutMode.ToLower(),
        thickness = (double)Model.DonutThickness,
        showLegend = Model.DonutShowLegend,
        showCenterText = Model.DonutShowCenterText,
        valueFormat = string.IsNullOrWhiteSpace(Model.DonutValueFormat) ? "0" : Model.DonutValueFormat,
        slices = (Model.Slices ?? new List<DonutSlice>()).Select(s => new
        {
            label = s.Label ?? "",
            value = s.Value,
            color = s.Color,            // optional
            displayValue = s.DisplayValue // optional
        }).ToList()
    };

    // ¬„‰ œ«Œ· <script type="application/json">
    var json = JsonSerializer.Serialize(cfg, new JsonSerializerOptions
    {
        Encoder = JavaScriptEncoder.Default,
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase
    });
}

<div id="@hostId"
     class="smart-donut"
     data-config-id="@configId"
     data-tone="@Model.Tone.ToString().ToLower()">
</div>

<script type="application/json" id="@configId">
    @Html.Raw(json)
</script>
