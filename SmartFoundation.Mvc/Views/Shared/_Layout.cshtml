<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - SmartFoundation.Mvc</title>

    <!-- CSS -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/datepicker.min.css" />

    <style>
        [x-cloak] { display: none !important; }

        /* Unify borders in dark mode */
        html.dark .border-gray-200 {
            border-color: #1f2937 !important;
        }

        /* Prevent background flash when switching themes */
        body {
            transition: background-color 0.2s ease, color 0.2s ease;
        }
    </style>

    <script>
        // Apply dark theme before render to prevent flash
        if (localStorage.getItem('color-theme') === 'dark' ||
           (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>

<body class="text-gray-900 transition-colors duration-300 bg-gray-50 dark:bg-gray-900 dark:text-gray-100">


    <!-- ✅ Navbar + Sidebar -->
    @await Component.InvokeAsync("MenuItems")

    <!-- ✅ Main content area -->
    <div id="main-content"
         class="relative z-0 flex flex-col min-h-screen pt-16 transition-all duration-300 bg-gray-100 sm:mr-64" >

        <!-- Content -->
        <main class="flex-1 px-4 pt-6">
            @* <div class="p-6 bg-white border rounded-lg shadow-sm " style="border-color: rgb(229 231 235)"> *@
                @RenderBody()
            @* </div> *@
        </main>

        <!-- ✅ Footer -->
        <footer class="mt-auto bg-white border-t " style="border-color:rgb(229 231 235)">
            <div class="px-4 py-4 text-sm text-center text-gray-600 dark:text-gray-400">
              <span class="text-black-600 ">
                   إدارة مدينة الملك فيصل العسكرية &copy;
                </span>
                   @* - All rights reserved @DateTime.UtcNow.Year - &copy; *@
              
            </div>
        </footer>
    </div>

    <!-- ✅ Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="~/js/flowbite.min.js" defer></script>
    <script src="~/js/datepicker.min.js"></script>
    <script src="~/js/sf-select.js"></script>
    <script src="~/js/sf-date.js"></script>
    <script src="~/js/alpinejs.min.js" defer></script>
    <script src="~/js/sf-form.js"></script>
    <script src="~/js/sf-table.js"></script>

    <!-- moment.js + moment-hijri for Hijri date support (local files) -->
    <script src="~/js/moment.min.js"></script>
    <script src="~/js/moment-hijri.min.js"></script>
    <script src="~/js/sf-dual-date.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
<script>
document.addEventListener('DOMContentLoaded', function () {
  const btn = document.getElementById('theme-toggle');
  const darkIcon = document.getElementById('theme-toggle-dark-icon');
  const lightIcon = document.getElementById('theme-toggle-light-icon');

  if (!btn || !darkIcon || !lightIcon) return;

  // ✅ Ensure dark class is applied to <html> BEFORE rendering
  if (localStorage.getItem('color-theme') === 'dark' ||
     (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark'); // ✅ this line is missing in your version
    lightIcon.classList.remove('hidden');
  } else {
    document.documentElement.classList.remove('dark'); // ✅ also ensure it's removed in light mode
    darkIcon.classList.remove('hidden');
  }

  // 🌗 Toggle theme
  btn.addEventListener('click', () => {
    darkIcon.classList.toggle('hidden');
    lightIcon.classList.toggle('hidden');

    if (localStorage.getItem('color-theme')) {
      if (localStorage.getItem('color-theme') === 'light') {
        document.documentElement.classList.add('dark');
        localStorage.setItem('color-theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('color-theme', 'light');
      }
    } else {
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('color-theme', 'light');
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('color-theme', 'dark');
      }
    }
  });
});
</script>


</body>
</html>
