@{
    Layout = null;
    var lastUser = TempData["LastUser"] as string ?? "";

}
<!DOCTYPE html>
<html>
<head lang="ar" dir="rtl">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, minimal-ui" />
    <link rel="icon" href="~/img/Royal_Saudi_Land_Forces.png" />

    <title>تسجيل دخول للبوابة</title>
    <!-- JS -->
    <script src="~/js/jquery-3.7.1.min.js"></script>
    <script src="~/js/toastr.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/Login.css" />
    <!-- FontAwesome -->
    <link rel="stylesheet" type="text/css" href="/css/Fontawesome6-5-0.min.css" />
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="~/lib/toastr/css/toastr.min.css" />

</head>
<body class="login-page">
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // أرقام فقط في الهوية
            const NationalID = document.getElementById("txtNationalID");
            if (NationalID) {
                NationalID.addEventListener("input", function () {
                    this.value = this.value.replace(/[^0-9]/g, "");
                });
            }

            // إظهار/إخفاء كلمة المرور
            const toggle = document.getElementById("togglePassword");
            const password = document.getElementById("txtPassword");
            const eye = document.getElementById("eyeIcon");

            if (toggle && password && eye) {
                toggle.addEventListener("click", () => {
                    const isPwd = password.type === "password";
                    password.type = isPwd ? "text" : "password";
                    eye.classList.toggle("fa-eye");
                    eye.classList.toggle("fa-eye-slash");
                });
            }
            
             /* ===============================
                 تذكرني (Remember Me)
            =============================== */
            const rememberMe = document.getElementById("remember-me");

            // عند فتح الصفحة: استرجاع الهوية
            const savedNationalID = localStorage.getItem("rememberedNationalID");
            if (savedNationalID && NationalID && rememberMe) {
                NationalID.value = savedNationalID;
                rememberMe.checked = true;

                // UX: إذا الهوية موجودة، روح مباشرة لكلمة المرور
                if (password) password.focus();
            }
            const form = document.getElementById("loginForm");
            const btnLogin = document.getElementById("btnLogin");
            const btnText = document.getElementById("btnText");
            const spinner = btnLogin ? btnLogin.querySelector(".spinner-border") : null;

            if (form && btnLogin) {
                form.addEventListener("submit", function () {
                    
                    // حفظ / حذف الهوية
                    if (rememberMe && rememberMe.checked && NationalID) {
                        localStorage.setItem("rememberedNationalID", NationalID.value);
                    } else {
                        localStorage.removeItem("rememberedNationalID");
                    }
                    // UI Loading
                    // if (btnText) btnText.style.display = "none";
                    // if (spinner) spinner.style.display = "block";
                    // btnLogin.disabled = true;
                            // UI Loading
                    if (btnText) btnText.style.display = "none";
                    if (spinner) spinner.style.display = "inline-flex";
                    btnLogin.disabled = true;
                });
            }
        });
    </script>
    <form id="loginForm" method="post" asp-controller="Login" asp-action="CheckLogin">
        <div class="login-shell relative -m-3 h-screen p-3 sm:-mx-8 sm:px-8lg:overflow-hiddenxl:bg-white dark:bg-darkmode-800 xl:dark:bg-darkmode-600 isolate contain-paint motion-safe:will-change-transform">
            <div class="login-container relative z-10 container sm:px-10">
                <div class="login-center">
                    <div class="login-brand-top">
                        <img class="login-brand-logo"
                             src="~/img/Royal_Saudi_Land_Forces.png"
                             alt="KFMC" />
                        <div class="login-brand-title">
                            لإدارة مدينة الملك فيصل العسكرية
                        </div>
                    </div>
                    <div class="login-form-col my-10 flex h-screen py-5 xl:my-0 xl:h-auto xl:py-0">
                        <div class="login-form-card mx-auto my-auto w-full rounded-md bg-white px-5 py-8 shadow-md sm:w-3/4 sm:px-8 lg:w-2/4 xl:ml-20 xl:w-auto xl:bg-transparent xl:p-0 xl:shadow-none dark:bg-darkmode-600">
                            
                            <h2 class="intro-x login-title">
                                <span class="login-title-inner">
                                    <svg class="login-icon" fill="none" stroke="currentColor" stroke-width="2"
                                         viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                                        <polyline points="10 17 15 12 10 7" />
                                        <line x1="15" y1="12" x2="3" y2="12" />
                                    </svg>
                                    <span class="login-text">تسجيل الدخول</span>
                                </span>
                            </h2>

                            @if (ViewBag.ErrorMessage != null)
                            {
                                <div class="alert alert-danger mt-4">
                                    @ViewBag.ErrorMessage
                                </div>
                            }

                            <div class="intro-x mt-8">

                                <!-- National ID with icon -->
                                <div class="relative">
                                    <input type="text"
                                           name="NationalID"
                                           id="txtNationalID"
                                           value="@lastUser"
                                           placeholder="رقم الهوية الوطنية"
                                           maxlength="10"
                                           class="form-control intro-x login__input block w-full rounded-md border-slate-200 px-4 py-3 text-sm shadow-sm transition duration-200 ease-in-out placeholder:text-slate-400/90 focus:ring-primary focus:ring-opacity-20 focus:border-primary focus:border-opacity-40 focus:ring-4 disabled:cursor-not-allowed disabled:bg-slate-100 xl:min-w-[350px] dark:bg-darkmode-800 dark:border-transparent dark:focus:ring-opacity-50 dark:disabled:border-transparent dark:placeholder:text-slate-500/80 dark:focus:ring-slate-700" />

                                    <span id="nationalIdIcon"
                                          class="justify-content-center absolute inset-y-0 right-0 flex items-center px-3">
                                        <i class="fa fa-id-card" id="nationalIdIconI"></i>
                                    </span>
                                </div>
                                <div class="login__input-error text-danger mt-2" id="error-email"></div>

                                <div class="relative mt-4">
                                    <input type="password"
                                           name="password"
                                           id="txtPassword"
                                           placeholder="كلمة المرور"
                                           class="form-control w-full rounded-md border-slate-200 px-4 py-3 pr-10 text-sm shadow-sm placeholder:text-slate-400/90 focus:ring-primary focus:ring-opacity-20 focus:border-primary focus:border-opacity-40 focus:ring-4 dark:bg-darkmode-800 dark:border-transparent dark:focus:ring-opacity-50 dark:placeholder:text-slate-500/80 dark:focus:ring-slate-700" />

                                    <span id="togglePassword" class="absolute inset-y-0 right-0 flex cursor-pointer items-center px-3 hover:text-primary">
                                        <i class="fa fa-eye-slash" id="eyeIcon" style="font-size:20px;color:black;"></i>
                                    </span>
                                </div>
                                <div class="login__input-error text-danger mt-2" id="error-password"></div>
                            </div>


                            <div class="intro-x mt-4 flex text-xs text-slate-600 sm:text-sm dark:text-slate-500">
                                <div class="mr-auto flex items-center">
                                    <input type="checkbox"
                                           name="rememberMe"
                                           id="remember-me"
                                           class="mr-2 cursor-pointer rounded border-slate-200 shadow-sm transition-all duration-100 ease-in-out focus:ring-primary focus:ring-opacity-20 focus:ring-4 focus:ring-offset-0 dark:bg-darkmode-800 dark:border-transparent" />
                                    <label class="cursor-pointer select-none" for="remember-me">
                                        تذكرني
                                    </label>
                                </div>
                                <a href="#" class="text-primary">نسيت كلمة المرور؟</a>
                            </div>

                            <div class="intro-x login-actions mt-5">
                                <button id="btnLogin"
                                        type="submit"
                                        class="login-btn login-btn-primary">
                                    <span id="btnText" class="btn-content">دخول</span>
                                    <span id="btnSpinner" class="spinner-border btn-content" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </span>
                                </button>

                                <a href="@Url.Action("Register", "Account")"
                                   class="login-btn login-btn-outline">
                                    تسجيل
                                </a>
                            </div>


                        </div>
                    </div>

                </div>
            </div>
        </div>

    </form>
    <script>
        toastr.options = {
            closeButton: true,
            progressBar: true,
            positionClass: "toast-top-center",
            timeOut: 7500,
            rtl: true
        };

        @* رسائل TempData من LoginController *@
        @if (TempData["Success"] != null)
        {
                <text>toastr.success("@TempData["Success"]");</text>
        }
        @if (TempData["Error"] != null)
        {
                <text>toastr.error("@TempData["Error"]");</text>
        }
        @if (TempData["Warning"] != null)
        {
                <text>toastr.warning("@TempData["Warning"]");</text>
        }
        @if (TempData["Info"] != null)
        {
                <text>toastr.info("@TempData["Info"]");</text>
        }
    </script>

    <script>
        function resetLoginButton() {
            const btn = document.getElementById("btnLogin");
            const txt = document.getElementById("btnText");
            const spn = document.getElementById("btnSpinner");

            if (btn) btn.disabled = false;
            if (txt) txt.style.display = "inline-flex";
            if (spn) spn.style.display = "none";
        }
        document.addEventListener("DOMContentLoaded", resetLoginButton);
        window.addEventListener("pageshow", function () {
            resetLoginButton();
        });
    </script>


</body>
</html>